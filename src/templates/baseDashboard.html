{% load static %}
{% load active_link_tags %}

<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="{% static 'css/main.css' %}">
    <script src="{% static 'js/popup.js' %}" defer></script>
    <script src="{% static 'js/changeShop.js' %}" defer></script>
    {% block extra_css %}{% endblock %}
    {% block extra_head %}{% endblock %}
    <title>{% block title %}Gestion de Stock{% endblock %}</title>
</head>
<body class="relative">
    <main class="flex m-0 p-0 w-full">
    <!--Navigation-->
        <div
                class="min-h-[100Vh] min-w-[200px] flex flex-col justify-between border-r-2 border-r-slate-300 drop-shadow py-4 bg-gray-200"
        >
            <div class="mx-auto text-center">
                <span class="font-semibold">Bonjour {{ user.username }}</span>
                <span class="flex items-center gap-2 text-sm text-green-500">
                    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24"><!-- Icon from Material Symbols Light by Google - https://github.com/google/material-design-icons/blob/master/LICENSE --><path fill="currentColor" d="M12.003 21q-1.866 0-3.51-.708q-1.643-.709-2.859-1.924t-1.925-2.856T3 12.003t.709-3.51Q4.417 6.85 5.63 5.634t2.857-1.925T11.997 3t3.51.709q1.643.708 2.859 1.922t1.925 2.857t.709 3.509t-.708 3.51t-1.924 2.859t-2.856 1.925t-3.509.709"/></svg>
                    Connecté
                </span>
            </div>
            <div class="text-center text-slate-700 text-sm my-1">{{ nombre_company }} société{{ nombre_company|pluralize }}</div>

            <div class="text-center text-slate-700 text-sm flex items-center justify-center gap-2 px-2" id="company-name">
                {% if request.current_company %}
                    <span>{{ request.current_company.name }}</span>
                {% else %}
                    <span>Aucun</span>
                {% endif %}
                <div class="btn-tinny btn-indigo-outline">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><!-- Icon from Material Symbols by Google - https://github.com/google/material-design-icons/blob/master/LICENSE --><path fill="currentColor" d="M4 20v-2h2.75l-.4-.35q-1.225-1.225-1.787-2.662T4 12.05q0-2.775 1.663-4.937T10 4.25v2.1Q8.2 7 7.1 8.563T6 12.05q0 1.125.425 2.188T7.75 16.2l.25.25V14h2v6zm10-.25v-2.1q1.8-.65 2.9-2.212T18 11.95q0-1.125-.425-2.187T16.25 7.8L16 7.55V10h-2V4h6v2h-2.75l.4.35q1.225 1.225 1.788 2.663T20 11.95q0 2.775-1.662 4.938T14 19.75"/></svg>
                </div>
            </div>
            <div class="separator"></div>
            <nav class="flex flex-col gap-0 flex-1 m-0 p-0">
                <a href="{% url 'stock:dashboard' %}" class="{% active_link 'stock:dashboard' 'current-link' 'link-dash' %}">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><!-- Icon from Tabler Icons by Paweł Kuna - https://github.com/tabler/tabler-icons/blob/master/LICENSE --><path fill="currentColor" d="M17 20.66a10 10 0 0 1-11.328-.917L12.414 13h9.536A10 10 0 0 1 17 20.66M11 2.05v9.534l-6.743 6.744A10 10 0 0 1 2 12l.005-.324A10 10 0 0 1 11 2.05m6 1.29A10 10 0 0 1 21.95 11H13V2.05a10 10 0 0 1 4 1.29"/></svg>
                    <span>Dashboard</span>
                </a>
                <a href="{% url 'user:profile' %}" class="{% active_link 'user:profile' 'current-link' 'link-dash' %}">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><!-- Icon from Google Material Icons by Material Design Authors - https://github.com/material-icons/material-icons/blob/master/LICENSE --><path fill="currentColor" d="M10.67 13.02c-.22-.01-.44-.02-.67-.02c-2.42 0-4.68.67-6.61 1.82c-.88.52-1.39 1.5-1.39 2.53V19c0 .55.45 1 1 1h8.26a6.96 6.96 0 0 1-.59-6.98"/><circle cx="10" cy="8" r="4" fill="currentColor"/><path fill="currentColor" d="M20.75 16c0-.22-.03-.42-.06-.63l.84-.73c.18-.16.22-.42.1-.63l-.59-1.02a.49.49 0 0 0-.59-.22l-1.06.36q-.48-.405-1.08-.63l-.22-1.09a.5.5 0 0 0-.49-.4h-1.18c-.24 0-.44.17-.49.4l-.22 1.09q-.6.225-1.08.63l-1.06-.36a.496.496 0 0 0-.59.22l-.59 1.02c-.12.21-.08.47.1.63l.84.73c-.03.21-.06.41-.06.63s.03.42.06.63l-.84.73c-.18.16-.22.42-.1.63l.59 1.02c.12.21.37.3.59.22l1.06-.36q.48.405 1.08.63l.22 1.09c.05.23.25.4.49.4h1.18c.24 0 .44-.17.49-.4l.22-1.09q.6-.225 1.08-.63l1.06.36c.23.08.47-.02.59-.22l.59-1.02c.12-.21.08-.47-.1-.63l-.84-.73c.03-.21.06-.41.06-.63M17 18c-1.1 0-2-.9-2-2s.9-2 2-2s2 .9 2 2s-.9 2-2 2"/></svg>
                    <span>Mon compte</span>
                </a>
                <span class="separator"></span>
                <span class="ml-4 font-semibold text-sm">Général</span>
                <a href="{% url 'catalog:product_list' %}" class="{% active_link 'catalog:product_list' 'current-link' 'link-dash' strict=True %}">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><!-- Icon from Solar by 480 Design - https://creativecommons.org/licenses/by/4.0/ --><path fill="currentColor" d="M8.422 20.618C10.178 21.54 11.056 22 12 22V12L2.638 7.073l-.04.067C2 8.154 2 9.417 2 11.942v.117c0 2.524 0 3.787.597 4.801c.598 1.015 1.674 1.58 3.825 2.709z"/><path fill="currentColor" d="m17.577 4.432l-2-1.05C13.822 2.461 12.944 2 12 2c-.945 0-1.822.46-3.578 1.382l-2 1.05C4.318 5.536 3.242 6.1 2.638 7.072L12 12l9.362-4.927c-.606-.973-1.68-1.537-3.785-2.641" opacity=".7"/><path fill="currentColor" d="m21.403 7.14l-.041-.067L12 12v10c.944 0 1.822-.46 3.578-1.382l2-1.05c2.151-1.129 3.227-1.693 3.825-2.708c.597-1.014.597-2.277.597-4.8v-.117c0-2.525 0-3.788-.597-4.802" opacity=".5"/></svg>
                    <span>Mes produits</span>
                    <span class="badge badge-indigo">{{ nombre_produits }}</span>
                </a>
                <a href="{%  url 'catalog:category_list' %}" class="{% active_link 'catalog:category_list' 'current-link' 'link-dash' strict=True %}">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><!-- Icon from Tabler Icons by Paweł Kuna - https://github.com/tabler/tabler-icons/blob/master/LICENSE --><path fill="currentColor" d="M10 3H4a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4a1 1 0 0 0-1-1m10 0h-6a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4a1 1 0 0 0-1-1M10 13H4a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-6a1 1 0 0 0-1-1m7 0a4 4 0 1 1-3.995 4.2L13 17l.005-.2A4 4 0 0 1 17 13"/></svg>
                    <span>Mes catégories</span>
                    <span class="badge badge-indigo">{{ nombre_categories }}</span>
                </a>
                <a href="{% url 'order:company_list' %}" class="{% active_link 'order:company_list' 'current-link' 'link-dash' strict=True %}">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 14 14"><!-- Icon from Streamline by Streamline - https://creativecommons.org/licenses/by/4.0/ --><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" d="m.91 12.56l-.41-7A.5.5 0 0 1 1 5h4.61a.51.51 0 0 1 .49.38L6.5 7H13a.5.5 0 0 1 .5.54l-.39 5a1 1 0 0 1-1 .92H1.91a1 1 0 0 1-1-.9ZM3.5 3V1A.5.5 0 0 1 4 .5h8.5a.5.5 0 0 1 .5.5v4M7.5 3h3"/></svg>
                    <span>Mes sociétés</span>
                    <span class="badge badge-indigo">{{ nombre_company }}</span>
                </a>
                {%  if request.current_company %}
                    <span class="separator"></span>
                    <span class="ml-4 font-semibold text-sm">Stock</span>
                    <a href="{% url 'stock:flux' %}" class="{% active_link 'stock:flux' 'current-link' 'link-dash' strict=True %}">
                        <svg xmlns="http://www.w3.org/2000/svg" width="19.5" height="20" viewBox="0 0 504 512"><!-- Icon from File Icons by John Gardner - https://github.com/file-icons/icons/blob/master/LICENSE.md --><path fill="currentColor" d="M322.125 502.369L492.617 343.76c8.685-9.142 13.256-23.768 10.513-35.652L454.222 96.02c-2.742-11.427-13.255-23.311-25.14-26.51L206.483.946c-13.062-2.586-26.205.467-35.653 8.684L11.307 158.184C2.622 165.954-1.95 181.495.794 192.465l52.108 227.171c2.742 11.428 13.255 23.312 25.14 26.511l208.43 64.906c16.582 3.149 27.076-1.535 35.653-8.684M229.793 51.226l153.124 47.08c5.942 1.828 5.942 4.57 0 5.942L302.47 122.53c-5.942 1.828-14.627-.914-18.74-5.485L227.964 56.71c-5.028-5.028-4.114-7.314 1.828-5.485m95.531 274.25c1.829 5.943-2.285 9.6-8.227 7.771l-165.008-51.193c-5.942-1.829-7.313-6.857-2.743-10.97l126.156-117.471c4.57-4.571 9.599-2.743 10.97 3.2zM53.36 176.01L187.285 51.226c4.57-4.571 11.427-3.657 15.998.457l67.191 72.676c4.57 4.571 3.657 11.428-.457 15.998L136.09 265.142c-4.57 4.57-11.427 3.656-15.998-.457l-67.191-72.677c-4.571-5.028-4.114-12.341.457-15.998m32.453 197.46L50.616 218.063c-1.828-5.942.914-7.314 5.028-2.743l55.764 60.336c4.571 4.57 5.943 13.255 4.571 19.197l-24.225 78.619c-1.829 6.399-4.571 6.399-5.942 0m196.09 91.418l-175.064-54.393c-5.943-1.829-9.6-8.228-7.77-14.627l29.253-94.16c1.828-5.942 8.227-9.599 14.626-7.77l175.064 53.936c5.942 1.828 9.599 8.227 7.77 14.627l-29.253 94.16c-2.286 5.941-8.228 9.598-14.627 8.227M437.31 337.36L320.296 446.147c-4.57 4.571-6.856 2.743-5.028-3.2l24.226-78.618c1.828-5.942 8.227-12.341 14.627-13.256l80.447-18.283c5.942-2.285 6.856.457 2.742 4.571m12.798-23.768l-96.445 21.94c-5.942 1.828-12.34-2.286-13.712-8.228l-41.138-178.263c-1.828-5.942 2.286-12.341 8.228-13.713l96.445-21.94c5.942-1.828 12.341 2.286 13.712 8.228l41.138 178.263c1.371 6.856-2.285 12.798-8.228 13.713"/></svg>
                        <span>Flux</span>
                        <span class="badge badge-indigo">{{ nombre_order }}</span>
                    </a>
                    <a href="{% url 'stock:inventory' %}" class="{% active_link 'stock:inventory' 'current-link' 'link-dash' strict=True %}">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><!-- Icon from Google Material Icons by Material Design Authors - https://github.com/material-icons/material-icons/blob/master/LICENSE --><path fill="currentColor" d="M22 21V7L12 3L2 7v14h5v-9h10v9zm-11-2H9v2h2zm2-3h-2v2h2zm2 3h-2v2h2z"/></svg>
                        <span>Inventaire</span>
                        <span class="badge badge-indigo">{{ nombre_inventories }}</span>
                    </a>
                    <span class="separator"></span>
                    <span class="ml-4 font-semibold text-sm">Paramètres</span>
                    <a href="{% url 'order:state_list' %}" class="{% active_link 'order:state_list' 'current-link' 'link-dash' strict=True %}">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><!-- Icon from Material Symbols by Google - https://github.com/google/material-design-icons/blob/master/LICENSE --><path fill="currentColor" d="M5 21V5q0-.825.588-1.412T7 3h10q.825 0 1.413.588T19 5v16l-7-3z"/></svg>
                        <span>Statut</span>
                        <span class="badge badge-indigo">{{ nombre_state }}</span>
                    </a>
                {% endif %}
                <span class="separator"></span>
                <a href="{% url 'user:logout' %}" class="unconnected-link flex gap-1 items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><!-- Icon from Fluent UI System Icons by Microsoft Corporation - https://github.com/microsoft/fluentui-system-icons/blob/main/LICENSE --><path fill="currentColor" d="M21.707 3.707a1 1 0 0 0-1.414-1.414L18.496 4.09a4.25 4.25 0 0 0-5.251.604l-1.068 1.069a1.75 1.75 0 0 0 0 2.474l3.585 3.586a1.75 1.75 0 0 0 2.475 0l1.068-1.068a4.25 4.25 0 0 0 .605-5.25zm-11 8a1 1 0 0 0-1.414-1.414l-1.47 1.47l-.293-.293a.75.75 0 0 0-1.06 0l-1.775 1.775a4.25 4.25 0 0 0-.605 5.25l-1.797 1.798a1 1 0 1 0 1.414 1.414l1.798-1.797a4.25 4.25 0 0 0 5.25-.605l1.775-1.775a.75.75 0 0 0 0-1.06l-.293-.293l1.47-1.47a1 1 0 0 0-1.414-1.414l-1.47 1.47l-1.586-1.586z"/></svg>
                    Déconnexion
                </a>
            </nav>
        </div>

    <!--Content-->
        <div class="flex-1 py-4 px-6 bg-gray-100 z-0">
            {% block content %}
            {% endblock %}
        </div>
    </main>
    <div class="fixed top-2 right-2" id="popup">
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }} relative py-4 px-6 rounded-md min-w-[450px]">
                {{ message }}
                <div class="absolute bottom-0 left-0 progress-bar-3 progress-bar-{{ message.tags }}"></div>
            </div>
        {% endfor %}
    </div>

    <!--Change company-->
    {%  if nombre_company > 0 %}
        <div id="change-company-bg" class="w-[100vw] h-[100vh] bg-slate-300 fixed top-0 left-0 z-40 opacity-50 hidden"></div>
        <div id="change-company" class="fixed top-1/4 left-1/4 w-2/4 border py-16 px-8 rounded-md bg-white shadow-lg z-50 hidden">
            <form method="post" action="{% url 'order:change_company' %}" class="grid grid-cols-3 gap-0.5">
                {% csrf_token %}
                <div class="col-span-3 text-lg font-semibold">Actuel : {% if request.current_company.name %} {{ request.current_company.name }} {% else %} Aucun {% endif %}</div>
                <label for="company_id" class="col-span-3 text-sm text-slate-500">Changer de magasin : </label>
                <select name="company_id" id="company_id" class="col-span-2 border-2 border-slate-300 py-2 px-4 w-full rounded focus:border-indigo-500">
                    {% for company in request.list_company %}
                        <option value="{{ company.id }}" {% if company.id == request.current_company.id %}selected{% endif %}>{{ company.name }}</option>
                    {% endfor %}
                </select>
                <input type="hidden" name="next" value="{{ request.path }}">
                <button type="submit" class="btn btn-secondary">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"><!-- Icon from Material Symbols by Google - https://github.com/google/material-design-icons/blob/master/LICENSE --><path fill="currentColor" d="M4 20v-2h2.75l-.4-.35q-1.225-1.225-1.787-2.662T4 12.05q0-2.775 1.663-4.937T10 4.25v2.1Q8.2 7 7.1 8.563T6 12.05q0 1.125.425 2.188T7.75 16.2l.25.25V14h2v6zm10-.25v-2.1q1.8-.65 2.9-2.212T18 11.95q0-1.125-.425-2.187T16.25 7.8L16 7.55V10h-2V4h6v2h-2.75l.4.35q1.225 1.225 1.788 2.663T20 11.95q0 2.775-1.662 4.938T14 19.75"/></svg>
                </button>
            </form>
        </div>
    {% endif %}

    {% block scripts %}
    {% endblock %}
</body>
</html>